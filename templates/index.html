<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat de Soporte</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="chat-container">
    <h2>Asistente de Soporte</h2>
    <div id="chat-box"></div>

    <div class="input-row">
      <input id="user-input" type="text" placeholder="Escribe tu duda..." />
      <button id="send-btn">Enviar</button>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById("chat-box");
    const input = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");

    function addMsg(text, who = "bot") {
      const div = document.createElement("div");
      div.className = who === "user" ? "msg user" : "msg bot";
      div.innerHTML = text;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function ask(message) {
      addMsg(message, "user");
      const res = await fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ message })
      });
      const data = await res.json();

      let reply = data.respuesta;
      if (data.video) {
        reply += `<br><a href="${data.video}" target="_blank" rel="noopener">üé• Ver video</a>`;
      }
      if (data.sugerencias && data.sugerencias.length) {
        reply += `<div class="sugs"><b>Sugerencias:</b> ${data.sugerencias.map(s =>
          `<button class="sug-btn" onclick="fillAndSend('${s.replace(/'/g, "\\'")}')">${s}</button>`
        ).join(" ")}</div>`;
      }
      addMsg(reply, "bot");
    }

    function send() {
      const msg = input.value.trim();
      if (!msg) return;
      input.value = "";
      ask(msg);
    }

    function fillAndSend(text) {
      input.value = text;
      send();
    }

    sendBtn.addEventListener("click", send);
    input.addEventListener("keydown", e => {
      if (e.key === "Enter") send();
    });

    // Mensaje de bienvenida
    addMsg("¬°Hola! Cu√©ntame tu duda. Ej.: ‚ÄúNo puedo iniciar sesi√≥n‚Äù.");
  </script>
</body>
</html>
